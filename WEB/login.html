<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đăng nhập</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"/>

  <style>
 body {
  background-image: url('image.png');
         background-size: cover; /* giữ tỷ lệ */
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
  margin: 0; 
 
}

.login-box {
  width: 100%;
  max-width: 400px;
  padding: 30px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  position: fixed; 
  top: 50%; 
  left: 50%; 
  transform: translate(-50%, -50%); 

}
.login-box img {
  display: block; 
  margin: 0 auto; 
  max-width: 100%; 
}


  </style>
</head>
<body>

  <div class="login-box">
    <img src="logo.svg" alt="Logo">
    <h3 class="text-center mb-4">Đăng nhập hệ thống</h3>
    <form id="loginForm">
      <div class="mb-3">
        <label for="username" class="form-label">Tài khoản</label>
        <input type="text" class="form-control" id="username" required>
      </div>
      <div class="mb-3 position-relative">
        <label for="password" class="form-label">Mật khẩu</label>
        <input type="password" class="form-control" id="password" required>
        <i class="bi bi-eye-slash toggle-password" id="togglePassword"
           style="position:absolute; top:38px; right:10px; cursor:pointer;"></i>
      </div>
      <div class="text-right mt-3">
        <a href="forget.html">Quên mật khẩu?</a>
      </div>
      <br>
      <button type="submit" class="btn btn-primary w-100">Đăng nhập</button>
    </form>
    <div class="text-center mt-3">
      <a href="register.html">Chưa có tài khoản? Đăng ký ngay</a>
    </div>
  </div>

<script>
  // kiểm tra token
  if (localStorage.getItem('access_token')) {
    window.location.href = 'index.html';
  }
  $('#loginForm').submit(function(e) {
    Swal.fire({ title: 'Đang đăng nhập...', didOpen: () => { Swal.showLoading(); } });
    e.preventDefault();
    const username = $('#username').val().trim();
    const password = $('#password').val().trim();
    setTimeout(function() {
    $.ajax({
      url: 'https://khaituanminh.atwebpages.com/api/login.php',
      method: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({ username, password }),
      success: function(res) {
        if (res.status === 'success') {
          localStorage.setItem('access_token', res.data.access_token);
          localStorage.setItem('id_account', res.data.id_account);
          $.ajax({
            url: 'https://khaituanminh.atwebpages.com/api/my_profile.php',
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ access_token: res.data.access_token }),
            success: function(profileRes) {
              if (profileRes.status === 'success') {
                localStorage.setItem('user_info', JSON.stringify(profileRes.data));
                localStorage.setItem('id_business', profileRes.data.id_business);
                localStorage.setItem('id_user', profileRes.data.id_user);

                localStorage.setItem('account_name', profileRes.data.name);
                localStorage.setItem('id_businesstype', profileRes.data.id_businesstype);
                localStorage.setItem('id_role', profileRes.data.id_role); 
                Swal.fire({
                  icon: 'success',
                  title: 'Đăng nhập thành công!',
                  timer: 1200,
                  showConfirmButton: false,
                  position: 'top-center' 
                }).then(() => {
                  const role = localStorage.getItem('id_role');
                  if(role ==="4")
                  window.location.href = 'ADMIN/business.html';
                  else
                  window.location.href = 'index.html';
                });
              } else {
                Swal.fire('Lỗi', 'Lỗi xác thực người dùng!', 'error');
              }
            },
            error: function() {
              Swal.fire('Lỗi', 'Không thể lấy thông tin người dùng', 'error');
            }
          });

        } else {
          Swal.fire('Lỗi', res.message, 'error');
        }
      },
      error: function() {
        Swal.fire('Lỗi', 'Không thể kết nối đến máy chủ.', 'error');
      }
    });
  }, 500);
  });
</script>
<script>

  $('#togglePassword').on('click', function () {
    const passwordInput = $('#password');
    const type = passwordInput.attr('type') === 'password' ? 'text' : 'password';
    passwordInput.attr('type', type);

   
    $(this).toggleClass('bi-eye');
    $(this).toggleClass('bi-eye-slash');
  });
</script>

</body>
</html>
